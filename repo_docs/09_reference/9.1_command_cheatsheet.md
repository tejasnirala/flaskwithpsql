# 9.1 Command Cheatsheet

> **All Commands in One Place**

This reference document provides quick access to all commonly used commands for this project.

---

## Table of Contents

1. [Flask Commands](#flask-commands)
2. [Database Commands](#database-commands)
3. [Testing Commands](#testing-commands)
4. [Docker Commands](#docker-commands)
5. [Code Quality Commands](#code-quality-commands)
6. [Git Commands](#git-commands)
7. [Make Commands](#make-commands)

---

## Flask Commands

### Development Server

```bash
# Start development server
flask run

# Start with specific port
flask run --port 5500

# Start with reload enabled
flask run --reload

# Start accessible from network
flask run --host 0.0.0.0

# Full command for development
flask run --host 0.0.0.0 --port 5500 --reload
```

### Environment Setup

```bash
# Set Flask app (required if not in run.py)
export FLASK_APP=run.py

# Set environment mode
export FLASK_ENV=development  # or production, testing
```

### Flask Shell

```bash
# Start interactive shell with app context
flask shell

# In shell: access models, services, etc.
>>> from app.models import User
>>> User.query.all()
```

---

## Database Commands

### Migrations (Flask-Migrate)

```bash
# Initialize migrations (first time only)
flask db init

# Create a new migration
flask db migrate -m "Description of changes"

# Apply migrations
flask db upgrade

# Roll back last migration
flask db downgrade

# View migration history
flask db history

# View current migration version
flask db current

# Mark migration as complete (without running)
flask db stamp head
```

### Custom Database Commands

```bash
# Using our db_manage.py script
python db_manage.py init     # Initialize database
python db_manage.py seed     # Add seed data
python db_manage.py reset    # Reset database

# Or via Flask CLI
flask db-init
flask db-seed
flask db-reset
```

### PostgreSQL Direct

```bash
# Connect to PostgreSQL
psql -U postgres -d flaskwithpsql

# Inside psql:
\dt                  # List tables
\d users.users       # Describe table
\q                   # Quit

# Execute SQL file
psql -U postgres -d flaskwithpsql -f script.sql
```

---

## Testing Commands

### pytest

```bash
# Run all tests
pytest

# Run with verbose output
pytest -v

# Run with very verbose output
pytest -vv

# Stop on first failure
pytest -x

# Run last failed tests
pytest --lf

# Run specific test file
pytest tests/test_services/test_user_service.py

# Run specific test class
pytest tests/test_services/test_user_service.py::TestUserServiceCreate

# Run specific test function
pytest tests/test_services/test_user_service.py::TestUserServiceCreate::test_create_user_success

# Run tests matching pattern
pytest -k "create_user"

# Run tests with marker
pytest -m slow

# Run without markers
pytest -m "not slow"

# Drop into debugger on failure
pytest --pdb
```

### Coverage

```bash
# Run with coverage
pytest --cov=app

# Show missing lines
pytest --cov=app --cov-report=term-missing

# Generate HTML report
pytest --cov=app --cov-report=html

# Fail if below threshold
pytest --cov=app --cov-fail-under=80

# Include branch coverage
pytest --cov=app --cov-branch
```

---

## Docker Commands

### Docker Compose

```bash
# Start all services
docker compose up

# Start in background
docker compose up -d

# Start specific service
docker compose up web

# Stop all services
docker compose down

# Stop and remove volumes (DELETES DATA)
docker compose down -v

# Rebuild images
docker compose build

# Rebuild and start
docker compose up --build

# View logs
docker compose logs

# Follow logs
docker compose logs -f

# Logs for specific service
docker compose logs web

# Run command in service
docker compose run --rm web pytest
docker compose run --rm web flask db upgrade

# Execute in running container
docker compose exec web bash
docker compose exec web python -c "print('hello')"
```

### Docker

```bash
# List running containers
docker ps

# List all containers
docker ps -a

# List images
docker images

# Build image
docker build -t myapp:tag .

# Build with target
docker build --target production -t myapp:prod .

# Run container
docker run -p 5500:5500 myapp

# Run in background
docker run -d -p 5500:5500 myapp

# Stop container
docker stop <container_id>

# Remove container
docker rm <container_id>

# View container logs
docker logs <container_id>

# Execute in container
docker exec -it <container_id> bash

# Clean up
docker container prune   # Remove stopped containers
docker image prune       # Remove unused images
docker system prune      # Remove everything unused
```

---

## Code Quality Commands

### Formatting

```bash
# Format with Black
black app/ tests/

# Check without modifying
black --check app/ tests/

# Sort imports
isort app/ tests/

# Check imports without modifying
isort --check-only app/ tests/
```

### Linting

```bash
# Run flake8
flake8 app/ tests/

# Run with specific config
flake8 app/ --max-line-length=100 --extend-ignore=E203
```

### Type Checking

```bash
# Run mypy
mypy app/

# Ignore missing imports
mypy app/ --ignore-missing-imports
```

### Security

```bash
# Run Bandit
bandit -r app/

# Check dependencies
safety check
```

### Pre-commit

```bash
# Install hooks
pre-commit install
pre-commit install --hook-type commit-msg

# Run on all files
pre-commit run --all-files

# Run specific hook
pre-commit run black --all-files

# Update hooks to latest
pre-commit autoupdate

# Skip hooks for one commit
git commit --no-verify -m "message"
SKIP=mypy git commit -m "message"
```

---

## Git Commands

### Basic Operations

```bash
# Clone repository
git clone <url>

# Check status
git status

# Stage all changes
git add .

# Commit with message
git commit -m "type: description"

# Push to remote
git push origin main
```

### Branching

```bash
# Create and switch to branch
git checkout -b feature/my-feature

# Switch branches
git checkout main

# List branches
git branch

# Delete branch
git branch -d feature/my-feature
```

### Conventional Commits

```bash
# Feature
git commit -m "feat: add user registration"

# Bug fix
git commit -m "fix: resolve login issue"

# Documentation
git commit -m "docs: update README"

# Refactor
git commit -m "refactor: simplify user service"

# Tests
git commit -m "test: add user service tests"
```

---

## Make Commands

If you have a Makefile:

```bash
# View all available commands
make help

# Development
make dev        # Start development server
make install    # Install dependencies

# Testing
make test       # Run tests
make test-cov   # Run tests with coverage

# Code quality
make format     # Format code
make lint       # Run linters
make check      # Run all checks

# Docker
make docker-up      # Start Docker services
make docker-down    # Stop Docker services
make docker-build   # Build Docker images

# Database
make db-upgrade     # Run migrations
make db-reset       # Reset database

# Cleanup
make clean      # Clean up temp files
```

---

## Quick Reference Card

### Most Used Commands

| Task                  | Command                           |
| --------------------- | --------------------------------- |
| **Start dev server**  | `flask run --port 5500`           |
| **Run tests**         | `pytest -v`                       |
| **Run with coverage** | `pytest --cov=app`                |
| **Format code**       | `black app/ tests/ && isort app/` |
| **Create migration**  | `flask db migrate -m "message"`   |
| **Apply migrations**  | `flask db upgrade`                |
| **Start Docker**      | `docker compose up`               |
| **Stop Docker**       | `docker compose down`             |
| **Run pre-commit**    | `pre-commit run --all-files`      |

---

> **Tip:** Consider adding these as aliases in your `.bashrc` or `.zshrc`:
>
> ```bash
> alias dc="docker compose"
> alias dcu="docker compose up"
> alias dcd="docker compose down"
> alias pt="pytest -v"
> alias ptc="pytest --cov=app"
> ```
