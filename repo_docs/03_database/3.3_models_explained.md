# ğŸ“ Models Explained

> **Defining Database Tables with Python Classes**

---

## ğŸ“‹ What is a Model?

A **model** is a Python class that represents a database table. Each instance of the class represents a row in that table.

---

## ğŸ†š Comparison with Node.js

### Mongoose (MongoDB)

```javascript
const userSchema = new mongoose.Schema({
    username: { type: String, required: true, unique: true },
    email: { type: String, required: true, unique: true },
    createdAt: { type: Date, default: Date.now },
});

const User = mongoose.model("User", userSchema);
```

### Prisma (PostgreSQL)

```prisma
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  createdAt DateTime @default(now())
}
```

### SQLAlchemy (Our Approach)

```python
class User(db.Model):
    __tablename__ = 'users'

    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
```

---

## ğŸ—ï¸ Model Structure

```python
from app import db

class User(db.Model):
    """
    User model representing the users table.
    """

    # ==========================================================================
    # TABLE CONFIGURATION
    # ==========================================================================
    __tablename__ = 'users'  # Explicit table name
    __table_args__ = {'schema': 'users'}  # Optional: PostgreSQL schema

    # ==========================================================================
    # COLUMNS
    # ==========================================================================
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False, index=True)
    email = db.Column(db.String(120), unique=True, nullable=False)

    # ==========================================================================
    # METHODS
    # ==========================================================================
    def __repr__(self):
        return f'<User {self.username}>'

    def to_dict(self):
        return {
            'id': self.id,
            'username': self.username,
            'email': self.email,
        }
```

---

## ğŸ“Š Column Types

| SQLAlchemy Type | PostgreSQL Type | Python Type | Example            |
| --------------- | --------------- | ----------- | ------------------ |
| `Integer`       | INTEGER         | `int`       | `1, 42, 1000`      |
| `BigInteger`    | BIGINT          | `int`       | Large numbers      |
| `String(n)`     | VARCHAR(n)      | `str`       | `"hello"`          |
| `Text`          | TEXT            | `str`       | Long text          |
| `Boolean`       | BOOLEAN         | `bool`      | `True, False`      |
| `DateTime`      | TIMESTAMP       | `datetime`  | `datetime.now()`   |
| `Date`          | DATE            | `date`      | `date.today()`     |
| `Float`         | FLOAT           | `float`     | `3.14`             |
| `Numeric(p, s)` | DECIMAL(p, s)   | `Decimal`   | Money values       |
| `JSON`          | JSONB           | `dict/list` | `{"key": "value"}` |
| `LargeBinary`   | BYTEA           | `bytes`     | Binary data        |

---

## ğŸ”§ Column Options

```python
db.Column(
    db.String(80),       # Column type

    # Constraints
    primary_key=True,    # This is the primary key
    unique=True,         # No duplicates allowed
    nullable=False,      # Cannot be NULL (required)

    # Performance
    index=True,          # Create index for faster queries

    # Defaults
    default="value",     # Default value
    default=func,        # Default from a function
    server_default="0",  # Default set by database

    # Auto-update
    onupdate=func,       # Called when row is updated

    # Documentation
    comment="Description",  # Column comment in database
)
```

---

## ğŸ“ Real Example: User Model

```python
# app/models/user.py

from sqlalchemy import Boolean, Column, String, Text
from app.models.base import BaseModel

class User(BaseModel):
    """
    User model representing the users table in PostgreSQL.

    Inherits from BaseModel:
        - id (Integer, Primary Key)
        - created_at (DateTime)
        - updated_at (DateTime)
        - is_deleted (Boolean)
    """

    __tablename__ = "users"
    __table_args__ = {"schema": "users"}  # PostgreSQL schema

    # Unique identifiers
    username = Column(String(100), unique=True, nullable=False, index=True)
    email = Column(String(120), unique=True, nullable=False, index=True)
    password_hash = Column(String(256), nullable=False)

    # Profile information
    first_name = Column(String(50), nullable=False)
    middle_name = Column(String(50), nullable=True)
    last_name = Column(String(50), nullable=True)
    bio = Column(Text, nullable=True)

    # Status flags
    is_active = Column(Boolean, default=True)

    def __repr__(self):
        return f"<User {self.username}>"

    def to_dict(self):
        """Convert to dictionary (excluding password)."""
        data = self.to_base_dict()  # From BaseModel
        data.update({
            "username": self.username,
            "email": self.email,
            "first_name": self.first_name,
            "middle_name": self.middle_name,
            "last_name": self.last_name,
            "bio": self.bio,
            "is_active": self.is_active,
        })
        return data
```

---

## ğŸ”„ Model to Table Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL â†’ TABLE MAPPING                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Python Class                     PostgreSQL Table              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚                                                                  â”‚
â”‚   class User(db.Model):      â†’     CREATE TABLE users.users (    â”‚
â”‚       __tablename__ = 'users'                                    â”‚
â”‚       __table_args__ =                                           â”‚
â”‚           {'schema': 'users'}                                    â”‚
â”‚                                                                  â”‚
â”‚       id = Column(Integer,   â†’         id SERIAL PRIMARY KEY,    â”‚
â”‚           primary_key=True)                                      â”‚
â”‚                                                                  â”‚
â”‚       username = Column(     â†’         username VARCHAR(100)     â”‚
â”‚           String(100),                   NOT NULL UNIQUE,        â”‚
â”‚           unique=True,                                           â”‚
â”‚           nullable=False,                                        â”‚
â”‚           index=True)        â†’         CREATE INDEX ...          â”‚
â”‚                                                                  â”‚
â”‚       email = Column(        â†’         email VARCHAR(120)        â”‚
â”‚           String(120),                   NOT NULL UNIQUE,        â”‚
â”‚           unique=True,                                           â”‚
â”‚           nullable=False)                                        â”‚
â”‚                                                                  â”‚
â”‚       is_active = Column(    â†’         is_active BOOLEAN         â”‚
â”‚           Boolean,                       DEFAULT TRUE            â”‚
â”‚           default=True)                                          â”‚
â”‚                                                                  â”‚
â”‚                              â†’     );                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Model File Organization

```
app/models/
â”œâ”€â”€ __init__.py      # Export all models
â”œâ”€â”€ base.py          # BaseModel with common fields
â””â”€â”€ user.py          # User model
```

### \_\_init\_\_.py

```python
# app/models/__init__.py
"""
Models Package.

Export all models for easy importing:
    from app.models import User
"""

from app.models.user import User

__all__ = ["User"]
```

---

## âš ï¸ Common Mistakes

### Mistake 1: Forgetting nullable=False

```python
# âŒ BAD - Allows NULL (might not be intended)
email = Column(String(120))

# âœ… GOOD - Explicit about requirements
email = Column(String(120), nullable=False)
```

### Mistake 2: Missing indexes

```python
# âŒ BAD - Slow queries on frequently searched fields
email = Column(String(120), unique=True)

# âœ… GOOD - Index for faster lookups
email = Column(String(120), unique=True, index=True)
```

### Mistake 3: Not using **tablename**

```python
# âŒ BAD - SQLAlchemy generates name (might not match conventions)
class UserProfile(db.Model):
    ...

# âœ… GOOD - Explicit table name
class UserProfile(db.Model):
    __tablename__ = 'user_profiles'
    ...
```

---

## ğŸ”œ Next Steps

Now that you understand basic models, let's look at our BaseModel pattern.

**Next: [3.4_base_model.md](./3.4_base_model.md)** - The BaseModel class.
