# ğŸŸï¸ JWT Explained

> **Understanding JSON Web Tokens**

---

## ğŸ“‹ What is JWT?

**JWT** (JSON Web Token) is an open standard (RFC 7519) for securely transmitting information between parties as a JSON object. The information is digitally signed, so it can be verified and trusted.

---

## ğŸ” JWT Structure

A JWT consists of three parts separated by dots (`.`):

```
xxxxx.yyyyy.zzzzz
  â”‚      â”‚      â”‚
  â”‚      â”‚      â””â”€â”€ Signature
  â”‚      â””â”€â”€ Payload
  â””â”€â”€ Header
```

### Example Token

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjEsInVzZXJuYW1lIjoiam9obiIsImVtYWlsIjoiam9obkBleGFtcGxlLmNvbSIsImlhdCI6MTcwMDAwMDAwMCwiZXhwIjoxNzAwMDAwOTAwLCJqdGkiOiJ1dWlkLTEyMzQiLCJ0eXBlIjoiYWNjZXNzIn0.dGhpcyBpcyBhIHNpZ25hdHVyZQ
```

---

## ğŸ“Š Token Parts Explained

### 1. Header

The header contains metadata about the token:

```json
{
    "alg": "HS256", // Signing algorithm (HMAC SHA256)
    "typ": "JWT" // Token type
}
```

**Base64Url encoded** â†’ `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9`

### 2. Payload (Claims)

The payload contains the actual data (called "claims"):

```json
{
    "sub": 1, // Subject (user ID)
    "username": "john_doe", // Custom claim
    "email": "john@example.com", // Custom claim
    "iat": 1700000000, // Issued At (timestamp)
    "exp": 1700000900, // Expiration (timestamp)
    "jti": "uuid-1234-5678", // JWT ID (unique identifier)
    "type": "access" // Access or refresh token
}
```

**Base64Url encoded** â†’ `eyJzdWIiOjEsInVzZXJu...`

### 3. Signature

The signature is created by:

```
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret_key
)
```

This ensures:

-   The token hasn't been tampered with
-   The token was issued by a trusted source

---

## ğŸ”„ How JWT Authentication Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOGIN FLOW                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   CLIENT                              SERVER                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚ 1. POST /login  â”‚                                            â”‚
â”‚   â”‚    email: x     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚
â”‚   â”‚    password: y  â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                       â”‚ 2. Verify credentials   â”‚â”‚
â”‚                                       â”‚    - Find user by email â”‚â”‚
â”‚                                       â”‚    - Check password hashâ”‚â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚             â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                       â”‚ 3. Create JWT tokens    â”‚â”‚
â”‚                                       â”‚    - Access token (15m) â”‚â”‚
â”‚                                       â”‚    - Refresh token (30d)â”‚â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚             â”‚
â”‚   â”‚ 4. Store tokens â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚   â”‚    in client    â”‚  { access_token, refresh_token }           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       API REQUEST FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   CLIENT                              SERVER                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚ 1. GET /api/users   â”‚                                        â”‚
â”‚   â”‚    Authorization:   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚
â”‚   â”‚    Bearer <token>   â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                       â”‚ 2. Validate token       â”‚â”‚
â”‚                                       â”‚    - Check signature    â”‚â”‚
â”‚                                       â”‚    - Check expiration   â”‚â”‚
â”‚                                       â”‚    - Check blacklist    â”‚â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚             â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                       â”‚ 3. Extract user from    â”‚â”‚
â”‚                                       â”‚    token claims         â”‚â”‚
â”‚                                       â”‚    (sub = user_id)      â”‚â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚             â”‚
â”‚   â”‚ 4. Receive data â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚   â”‚    from API     â”‚  { success: true, data: [...] }            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŸï¸ Access Token vs Refresh Token

We use **two types of tokens** for security:

| Aspect        | Access Token            | Refresh Token             |
| ------------- | ----------------------- | ------------------------- |
| **Purpose**   | Authorize API requests  | Get new access tokens     |
| **Lifetime**  | Short (15 minutes)      | Long (30 days)            |
| **Stored**    | Memory/localStorage     | Secure storage            |
| **Sent with** | Every API request       | Only to /refresh endpoint |
| **If stolen** | Limited damage (15 min) | Must revoke immediately   |

### Why Two Tokens?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TWO-TOKEN STRATEGY                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Problem with single long-lived token:                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚   If stolen, attacker has access for weeks/months!               â”‚
â”‚                                                                  â”‚
â”‚   Solution: Two tokens with different lifetimes                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                                  â”‚
â”‚   Access Token (15 min)     Refresh Token (30 days)              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚   â€¢ Sent with every request â€¢ Only sent to /refresh              â”‚
â”‚   â€¢ If stolen, expires fast â€¢ Rarely transmitted                 â”‚
â”‚   â€¢ Can be stored in memory â€¢ Stored securely                    â”‚
â”‚                                                                  â”‚
â”‚   Flow:                                                          â”‚
â”‚   1. Login â†’ Get both tokens                                     â”‚
â”‚   2. Use access token for 15 min                                 â”‚
â”‚   3. Access expires â†’ Call /refresh with refresh token           â”‚
â”‚   4. Get new access token â†’ Continue using API                   â”‚
â”‚   5. Refresh expires â†’ User must log in again                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†š Node.js Comparison

### Node.js with `jsonwebtoken`

```javascript
const jwt = require("jsonwebtoken");

// Create token
const token = jwt.sign({ userId: 1, username: "john" }, process.env.JWT_SECRET, {
    expiresIn: "15m",
});

// Verify token
try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    console.log(decoded.userId); // 1
} catch (err) {
    console.log("Invalid token");
}
```

### Flask with Flask-JWT-Extended

```python
from flask_jwt_extended import create_access_token, get_jwt_identity

# Create token
access_token = create_access_token(
    identity=user.id,
    additional_claims={'username': user.username}
)

# Get user from token (in protected route)
@jwt_required()
def protected():
    user_id = get_jwt_identity()  # 1
    return {'user_id': user_id}
```

---

## ğŸ” JWT Claims Reference

### Standard Claims (Registered)

| Claim | Name       | Description                      |
| ----- | ---------- | -------------------------------- |
| `sub` | Subject    | The user ID                      |
| `iat` | Issued At  | When token was created           |
| `exp` | Expiration | When token expires               |
| `jti` | JWT ID     | Unique token identifier          |
| `nbf` | Not Before | Token not valid before this time |
| `iss` | Issuer     | Who created the token            |
| `aud` | Audience   | Who the token is for             |

### Our Custom Claims

| Claim      | Description           |
| ---------- | --------------------- |
| `username` | User's username       |
| `email`    | User's email          |
| `type`     | "access" or "refresh" |

---

## âš ï¸ JWT Security Considerations

### What JWT Does âœ…

-   **Integrity**: Can detect if token was modified
-   **Authentication**: Proves identity
-   **Stateless**: No server session needed

### What JWT Does NOT Do âŒ

-   **Encryption**: Payload is readable (base64 encoded, NOT encrypted)
-   **Hide data**: Don't put secrets in JWT payload

```python
# âŒ BAD - Anyone can decode and read this!
claims = {
    "password": "secret123",      # NEVER do this!
    "credit_card": "1234-5678",   # NEVER do this!
}

# âœ… GOOD - Only non-sensitive identifiers
claims = {
    "sub": user.id,
    "username": user.username,
}
```

---

## ğŸ” Decoding a JWT (Without Verifying)

You can decode any JWT without the secret key:

```python
import base64
import json

token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjF9.xxx"

# Split by dots
header_b64, payload_b64, signature = token.split('.')

# Decode (add padding if needed)
payload = json.loads(base64.urlsafe_b64decode(payload_b64 + '=='))
print(payload)  # {'sub': 1}
```

**This is why you NEVER put sensitive data in JWT!**

---

## ğŸ”œ Next Steps

Now let's see how Flask-JWT-Extended implements this.

**Next: [5.3_flask_jwt_extended.md](./5.3_flask_jwt_extended.md)** - Using Flask-JWT-Extended.
