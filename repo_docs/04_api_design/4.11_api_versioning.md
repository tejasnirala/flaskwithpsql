# ğŸ”¢ API Versioning - Complete Guide

> **Understanding API Versioning: Why, What, and How**

This document explains how API versioning is implemented in this Flask application, why it matters, and how to use it effectively.

---

## ğŸ“‹ Table of Contents

1. [What is API Versioning?](#what-is-api-versioning)
2. [Why Do We Need It?](#why-do-we-need-it)
3. [Versioning Strategies](#versioning-strategies)
4. [Our Implementation](#our-implementation)
5. [Directory Structure](#directory-structure)
6. [How It Works](#how-it-works)
7. [Request Flow](#request-flow)
8. [Creating a New API Version](#creating-a-new-api-version)
9. [Best Practices](#best-practices)
10. [Migration Guide](#migration-guide)

---

## ğŸ¯ What is API Versioning?

API versioning is a technique to manage changes to your API over time while maintaining backward compatibility for existing clients.

Think of it like software versions:

-   **v1.0** - Initial release
-   **v2.0** - Breaking changes, new features
-   **v3.0** - Major overhaul

**Express.js Analogy:**

```javascript
// Express - No versioning (common mistake)
app.use("/users", usersRouter);

// Express - With versioning
app.use("/api/v1/users", usersV1Router);
app.use("/api/v2/users", usersV2Router);
```

---

## ğŸ’¡ Why Do We Need It?

### The Problem Without Versioning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WITHOUT API VERSIONING                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Day 1: API Released                                           â”‚
â”‚   GET /api/users â†’ { "name": "John", "email": "john@test.com" }â”‚
â”‚                                                                 â”‚
â”‚   Day 30: Need to change response format                        â”‚
â”‚   GET /api/users â†’ { "full_name": "John Doe", ...}             â”‚
â”‚                                                                 â”‚
â”‚   ğŸ’¥ BREAKING CHANGE!                                           â”‚
â”‚   - All mobile apps crash                                       â”‚
â”‚   - All partner integrations fail                               â”‚
â”‚   - Customers are angry                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Solution With Versioning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WITH API VERSIONING                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Day 1: API v1 Released                                        â”‚
â”‚   GET /api/v1/users â†’ { "name": "John", ... }                  â”‚
â”‚                                                                 â”‚
â”‚   Day 30: Release v2 with new format                            â”‚
â”‚   GET /api/v1/users â†’ { "name": "John", ... }      âœ… Still worksâ”‚
â”‚   GET /api/v2/users â†’ { "full_name": "John Doe" }  âœ… New clientsâ”‚
â”‚                                                                 â”‚
â”‚   âœ… Old clients continue working                               â”‚
â”‚   âœ… New clients use improved API                               â”‚
â”‚   âœ… Gradual migration possible                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Benefits

| Benefit                    | Description                           |
| -------------------------- | ------------------------------------- |
| **Backward Compatibility** | Existing clients don't break          |
| **Gradual Migration**      | Clients migrate at their own pace     |
| **Clear Contracts**        | Each version has a defined contract   |
| **Independent Evolution**  | Versions can evolve independently     |
| **Deprecation Path**       | Old versions can be sunset gracefully |

---

## ğŸ”€ Versioning Strategies

There are multiple ways to version APIs. Each has pros and cons:

### 1. URL Path Versioning (Our Choice âœ…)

```
GET /api/v1/users
GET /api/v2/users
```

| Pros                      | Cons                         |
| ------------------------- | ---------------------------- |
| Very explicit and visible | Slightly longer URLs         |
| Easy to understand        | Requires route restructuring |
| Easy to route/proxy       |                              |
| Cache-friendly            |                              |

### 2. Query Parameter Versioning

```
GET /api/users?version=1
GET /api/users?version=2
```

| Pros                    | Cons                         |
| ----------------------- | ---------------------------- |
| Simple to implement     | Easy to forget the parameter |
| Doesn't change base URL | Can be cached incorrectly    |
|                         | Not as explicit              |

### 3. Header Versioning

```
GET /api/users
X-API-Version: 1
```

| Pros                   | Cons                      |
| ---------------------- | ------------------------- |
| Clean URLs             | Hidden from URL           |
| Follows HTTP standards | Harder to test in browser |
|                        | Requires header knowledge |

### 4. Accept Header Versioning (Content Negotiation)

```
GET /api/users
Accept: application/vnd.myapp.v1+json
```

| Pros                  | Cons                        |
| --------------------- | --------------------------- |
| Most RESTful approach | Complex to implement        |
| Semantic versioning   | Harder to understand        |
|                       | Not intuitive for beginners |

### Why We Chose URL Path Versioning

1. **Explicitness**: The version is immediately visible
2. **Simplicity**: Easy to understand and implement
3. **Debugging**: Easy to test in browser/Postman
4. **Caching**: URL-based caching works perfectly
5. **Documentation**: Clear separation in Swagger UI

---

## ğŸ—ï¸ Our Implementation

### Directory Structure

```
app/
â”œâ”€â”€ __init__.py                  # App factory - registers api_v1 parent blueprint
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __init__.py              # Routes hub - exports api_v1
â”‚   â””â”€â”€ v1/                      # API Version 1
â”‚       â”œâ”€â”€ __init__.py          # Creates api_v1 parent blueprint (PREFIX DEFINED HERE!)
â”‚       â”œâ”€â”€ main.py              # url_prefix="/" â†’ becomes /api/v1/
â”‚       â””â”€â”€ users.py             # url_prefix="/users" â†’ becomes /api/v1/users
â”‚
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ __init__.py              # Auth module init (JWT utilities)
â”‚   â””â”€â”€ v1/                      # Auth Version 1
â”‚       â”œâ”€â”€ __init__.py          # Exports auth_bp_v1
â”‚       â””â”€â”€ routes.py            # url_prefix="/auth" â†’ becomes /api/v1/auth
```

### Key Concept: Parent Blueprint Pattern

The version prefix (`/api/v1`) is defined **ONCE** in the parent blueprint:

```python
# app/routes/v1/__init__.py

api_v1 = APIBlueprint(
    "api_v1",
    __name__,
    url_prefix="/api/v1",  # Version prefix - SINGLE SOURCE OF TRUTH!
)

# Child blueprints only define their resource prefix
api_v1.register_api(users_bp_v1)   # /users â†’ /api/v1/users
api_v1.register_api(auth_bp_v1)    # /auth â†’ /api/v1/auth
api_v1.register_api(main_bp_v1)    # / â†’ /api/v1/
```

This is exactly like Express.js nested routers:

```javascript
// Express.js equivalent
const v1Router = express.Router();
v1Router.use("/users", usersRouter);
v1Router.use("/auth", authRouter);
app.use("/api/v1", v1Router); // Version defined ONCE!
```

### API Endpoints Overview

#### Version 1 Endpoints (Current)

| Method | Endpoint                | Description                |
| ------ | ----------------------- | -------------------------- |
| GET    | `/api/v1/`              | Welcome/Root endpoint      |
| GET    | `/api/v1/health`        | Health check               |
| GET    | `/api/v1/users`         | List all users (paginated) |
| GET    | `/api/v1/users/<id>`    | Get user by ID             |
| PUT    | `/api/v1/users/<id>`    | Update user                |
| DELETE | `/api/v1/users/<id>`    | Delete user (soft)         |
| POST   | `/api/v1/auth/register` | Register new user          |
| POST   | `/api/v1/auth/login`    | Login                      |
| POST   | `/api/v1/auth/logout`   | Logout                     |
| POST   | `/api/v1/auth/refresh`  | Refresh token              |
| GET    | `/api/v1/auth/me`       | Get current user           |

---

## ğŸ”„ How It Works

### Blueprint Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APPLICATION STARTUP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   1. create_app() called                                            â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   2. Load configuration                                              â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   3. Initialize extensions (db, migrate, jwt, etc.)                 â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   4. Import parent blueprint                                         â”‚
â”‚      â””â”€â”€ from app.routes.v1 import api_v1                           â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   5. Register parent blueprint (ONE LINE!)                          â”‚
â”‚      â””â”€â”€ app.register_api(api_v1)                                   â”‚
â”‚          â”‚                                                           â”‚
â”‚          â”‚   (Internally, api_v1 contains:)                         â”‚
â”‚          â”‚   â”œâ”€â”€ main_bp_v1  â†’ /api/v1/                             â”‚
â”‚          â”‚   â”œâ”€â”€ users_bp_v1 â†’ /api/v1/users/*                      â”‚
â”‚          â”‚   â””â”€â”€ auth_bp_v1  â†’ /api/v1/auth/*                       â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   6. App is ready to handle requests!                               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Routing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REQUEST ROUTING                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   Client Request: GET /api/v1/users/123                             â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚  Flask Router    â”‚ â† Matches URL to blueprint                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚                                                         â”‚
â”‚            â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  URL Pattern Matching                         â”‚                  â”‚
â”‚   â”‚  /api/v1/users/<int:user_id>                 â”‚                  â”‚
â”‚   â”‚           â”‚       â”‚                           â”‚                  â”‚
â”‚   â”‚           â”‚       â””â”€â”€ user_id = 123           â”‚                  â”‚
â”‚   â”‚           â””â”€â”€ Blueprint: users_v1             â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â”‚                                                         â”‚
â”‚            â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚  Route Handler   â”‚ â† get_user(path=UserPath(user_id=123))       â”‚
â”‚   â”‚  users_bp_v1     â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚                                                         â”‚
â”‚            â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚  Service Layer   â”‚ â† UserService.get_by_id_or_404(123)          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚            â”‚                                                         â”‚
â”‚            â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚  Response        â”‚ â† success_response(data=user_data)           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†• Creating a New API Version (v2)

When you need to create a breaking change, follow these steps:

### Step 1: Create Version Directory

```bash
mkdir -p app/routes/v2
mkdir -p app/auth/v2
```

### Step 2: Create **init**.py Files

**`app/routes/v2/__init__.py`**:

```python
"""API Version 2 Routes Package."""

from app.routes.v2.main import main_bp_v2
from app.routes.v2.users import users_bp_v2

v2_blueprints = [main_bp_v2, users_bp_v2]

__all__ = ["v2_blueprints", "main_bp_v2", "users_bp_v2"]
```

### Step 3: Create Route Files

**`app/routes/v2/users.py`**:

```python
"""User routes - API v2.

This version includes breaking changes:
- Different response format
- New fields
- Changed endpoint behavior
"""

from flask_openapi3 import APIBlueprint, Tag

tag = Tag(name="Users (v2)", description="User management - Version 2")

users_bp_v2 = APIBlueprint(
    "users_v2",
    __name__,
    url_prefix="/api/v2/users",
    abp_tags=[tag],
)

@users_bp_v2.get("/")
def get_users():
    # New v2 implementation with different response format
    pass
```

### Step 4: Register in App Factory

**Update `app/__init__.py`**:

```python
# Import v2 blueprints
from app.auth.v2 import auth_bp_v2
from app.routes.v2 import v2_blueprints

# Register v2 blueprints
app.register_api(auth_bp_v2)
for bp in v2_blueprints:
    app.register_api(bp)
```

### Step 5: Update routes/**init**.py

```python
from app.routes.v1 import v1_blueprints
from app.routes.v2 import v2_blueprints

__all__ = ["v1_blueprints", "v2_blueprints"]
```

---

## âœ… Best Practices

### 1. Version Numbering

```
v1 â†’ Major version, stable
v2 â†’ Breaking changes from v1
v3 â†’ Breaking changes from v2
```

Don't use minor versions in URLs (v1.1, v1.2). Handle minor changes within the same major version.

### 2. When to Create a New Version

| Create New Version             | Don't Create New Version     |
| ------------------------------ | ---------------------------- |
| Removing a field               | Adding a new optional field  |
| Changing field type            | Adding a new endpoint        |
| Changing response structure    | Bug fixes                    |
| Removing an endpoint           | Performance improvements     |
| Changing authentication method | Adding optional query params |

### 3. Deprecation Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPRECATION TIMELINE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   Phase 1: Announce (Day 0)                                         â”‚
â”‚   â”œâ”€â”€ Add deprecation notice to v1 docs                            â”‚
â”‚   â”œâ”€â”€ Add Deprecation header to v1 responses                       â”‚
â”‚   â””â”€â”€ Announce v2 release                                           â”‚
â”‚                                                                      â”‚
â”‚   Phase 2: Grace Period (6-12 months)                               â”‚
â”‚   â”œâ”€â”€ Both v1 and v2 run simultaneously                            â”‚
â”‚   â”œâ”€â”€ Monitor v1 usage                                              â”‚
â”‚   â””â”€â”€ Help clients migrate                                          â”‚
â”‚                                                                      â”‚
â”‚   Phase 3: Sunset Warning (1-3 months before)                       â”‚
â”‚   â”œâ”€â”€ Send final warnings                                           â”‚
â”‚   â”œâ”€â”€ Log remaining v1 users                                        â”‚
â”‚   â””â”€â”€ Prepare shutdown                                              â”‚
â”‚                                                                      â”‚
â”‚   Phase 4: Shutdown (End Date)                                      â”‚
â”‚   â”œâ”€â”€ Remove v1 routes                                              â”‚
â”‚   â””â”€â”€ Return 410 Gone for v1 endpoints                              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Adding Deprecation Headers

```python
from flask import make_response

@users_bp.get("/")
def get_users():
    response = make_response(success_response(data=users_data))
    response.headers["Deprecation"] = "true"
    response.headers["Sunset"] = "Sat, 01 Jan 2028 00:00:00 GMT"
    response.headers["Link"] = '</api/v2/users>; rel="successor-version"'
    return response
```

### 5. API Version in Response

Always include the API version in responses for clarity:

```json
{
  "success": true,
  "data": {...},
  "meta": {
    "api_version": "v1"
  }
}
```

---

## ğŸ”„ Migration Guide

### For API Consumers

1. **Identify Current Version**: Check which endpoints you're using
2. **Review Changes**: Read the v2 changelog
3. **Update Base URL**: Change `/api/users` to `/api/v1/users`
4. **Test Integration**: Verify all calls work
5. **Plan v2 Migration**: When ready, migrate to v2

### For Developers

1. **Don't Modify v1**: Once released, v1 is frozen
2. **Document Changes**: Every version needs a changelog
3. **Test Both Versions**: Run tests for all active versions
4. **Monitor Usage**: Track which versions are used

---

## ğŸ“Š OpenAPI/Swagger Integration

With versioned routes, Swagger UI shows endpoints grouped by version:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SWAGGER UI                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   ğŸ“ Authentication                                                 â”‚
â”‚      â”œâ”€â”€ POST /api/v1/auth/register                                 â”‚
â”‚      â”œâ”€â”€ POST /api/v1/auth/login                                    â”‚
â”‚      â”œâ”€â”€ POST /api/v1/auth/logout                                   â”‚
â”‚      â”œâ”€â”€ POST /api/v1/auth/refresh                                  â”‚
â”‚      â””â”€â”€ GET  /api/v1/auth/me                                       â”‚
â”‚                                                                      â”‚
â”‚   ğŸ“ Users                                                          â”‚
â”‚      â”œâ”€â”€ GET    /api/v1/users                                       â”‚
â”‚      â”œâ”€â”€ GET    /api/v1/users/{id}                                  â”‚
â”‚      â”œâ”€â”€ PUT    /api/v1/users/{id}                                  â”‚
â”‚      â””â”€â”€ DELETE /api/v1/users/{id}                                  â”‚
â”‚                                                                      â”‚
â”‚   ğŸ“ Health                                                         â”‚
â”‚      â”œâ”€â”€ GET /api/v1/                                               â”‚
â”‚      â””â”€â”€ GET /api/v1/health                                         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Testing Versioned Routes

```python
# tests/test_v1_users.py

def test_get_users_v1(client):
    """Test v1 users endpoint."""
    response = client.get("/api/v1/users/")
    assert response.status_code == 200
    data = response.get_json()
    assert data["success"] == True
    assert "api_version" in data.get("meta", {})
    assert data["meta"]["api_version"] == "v1"


def test_non_versioned_route_returns_404(client):
    """Non-versioned routes should return 404."""
    response = client.get("/api/users/")
    assert response.status_code == 404
```

---

## ğŸ“š Code Examples

### Versioned Blueprint Definition

```python
# app/routes/v1/users.py

from flask_openapi3 import APIBlueprint, Tag

# Tag with version for Swagger grouping
tag = Tag(
    name="Users (v1)",
    description="User management - Version 1",
)

# Blueprint with versioned URL prefix
users_bp_v1 = APIBlueprint(
    "users_v1",              # Unique name (include version)
    __name__,
    url_prefix="/users",  # Just the resource - version added by parent!
    abp_tags=[tag],
)


@users_bp_v1.get("/")
def get_users():
    """Get all users - API v1."""
    return success_response(
        data=users,
        meta={"api_version": "v1"}
    )
```

### Version Module Init (Parent Blueprint Pattern)

```python
# app/routes/v1/__init__.py

from flask_openapi3 import APIBlueprint

from app.auth.v1.routes import auth_bp_v1
from app.routes.v1.main import main_bp_v1
from app.routes.v1.users import users_bp_v1

# Parent blueprint - VERSION PREFIX DEFINED ONCE HERE!
api_v1 = APIBlueprint(
    "api_v1",
    __name__,
    url_prefix="/api/v1",  # <-- Single source of truth!
)

# Register all child blueprints under the parent
api_v1.register_api(main_bp_v1)    # / â†’ /api/v1/
api_v1.register_api(users_bp_v1)   # /users â†’ /api/v1/users
api_v1.register_api(auth_bp_v1)    # /auth â†’ /api/v1/auth

__all__ = ["api_v1"]
```

### App Factory Registration (Simplified!)

```python
# app/__init__.py

def create_app(config_name="default"):
    # ... initialization code ...

    # Import the parent blueprint (contains ALL v1 routes)
    from app.routes.v1 import api_v1

    # Register ALL v1 routes with ONE line!
    app.register_api(api_v1)

    # ... rest of app setup ...
```

---

## ğŸ”— Related Documentation

-   [4.3 Routes Structure](4.3_routes_structure.md) - How routes are organized
-   [4.2 OpenAPI/Swagger](4.2_openapi_swagger.md) - API documentation
-   [2.4 Blueprints](../02_flask_fundamentals/2.4_blueprints.md) - Flask blueprints explained

---

> **Last Updated:** 2026-01-13
>
> **Status:** âœ… Complete
