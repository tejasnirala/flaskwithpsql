# ğŸ“š OpenAPI & Swagger

> **Auto-Generated API Documentation with flask-openapi3**

---

## ğŸ“‹ What is OpenAPI?

**OpenAPI** (formerly Swagger) is a specification for describing REST APIs. It defines:

-   Available endpoints
-   Request/response formats
-   Authentication methods
-   Data types and schemas

---

## ğŸ†š Comparison with Node.js

| Node.js            | Flask (Our Approach)      |
| ------------------ | ------------------------- |
| swagger-jsdoc      | flask-openapi3            |
| swagger-ui-express | Built into flask-openapi3 |
| Manual annotations | Pydantic schemas = auto   |
| Separate doc files | Inline with routes        |

---

## ğŸ“Š Why flask-openapi3?

Flask has several options for OpenAPI:

| Package            | Approach             | Validation   |
| ------------------ | -------------------- | ------------ |
| flask-restx        | Decorators + manual  | Built-in     |
| flask-smorest      | Marshmallow schemas  | Marshmallow  |
| **flask-openapi3** | **Pydantic schemas** | **Pydantic** |
| connexion          | Spec-first           | OpenAPI spec |

**We chose flask-openapi3 because:**

1. **Pydantic integration** - Same validation in routes and schemas
2. **Auto-documentation** - Schemas become docs automatically
3. **Type hints** - Full Python type support
4. **Active development** - Well-maintained

---

## ğŸ”§ Setup

### Installation

```bash
pip install flask-openapi3
```

### App Configuration

```python
# app/__init__.py
from flask_openapi3 import OpenAPI, Info

info = Info(
    title="Flask with PostgreSQL API",
    version="1.0.0",
    description="A production-ready Flask API with PostgreSQL",
)

app = OpenAPI(
    __name__,
    info=info,
)
```

---

## ğŸ“Š Swagger UI

flask-openapi3 automatically generates interactive documentation:

```
http://localhost:5000/openapi/swagger
```

### Features

1. **Try it out** - Execute API calls from the browser
2. **Schema viewer** - See all request/response formats
3. **Authentication** - Test protected endpoints
4. **Models** - Browse all data models

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask with PostgreSQL API           [Authorize]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â–¼ Health (v1)                                                   â”‚
â”‚    GET  /api/v1/           Root Endpoint                         â”‚
â”‚    GET  /api/v1/health     Health Check                          â”‚
â”‚                                                                  â”‚
â”‚  â–¼ Auth (v1)                                                     â”‚
â”‚    POST /api/v1/auth/register   Register User                    â”‚
â”‚    POST /api/v1/auth/login      Login User                       â”‚
â”‚    POST /api/v1/auth/refresh    Refresh Token                    â”‚
â”‚    POST /api/v1/auth/logout     Logout User                      â”‚
â”‚                                                                  â”‚
â”‚  â–¼ Users (v1)                                                    â”‚
â”‚    GET    /api/v1/users         Get All Users                    â”‚
â”‚    GET    /api/v1/users/{id}    Get User by ID                   â”‚
â”‚    PUT    /api/v1/users/{id}    Update User                      â”‚
â”‚    DELETE /api/v1/users/{id}    Delete User                      â”‚
â”‚                                                                  â”‚
â”‚  Schemas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚    UserCreateSchema                                              â”‚
â”‚    UserLoginSchema                                               â”‚
â”‚    UserResponseSchema                                            â”‚
â”‚    StandardSuccessResponse                                       â”‚
â”‚    StandardErrorResponse                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Alternative UIs

### Redoc (Alternative Documentation)

```
http://localhost:5000/openapi/redoc
```

Redoc provides a cleaner, more readable documentation format.

### OpenAPI JSON

```
http://localhost:5000/openapi/openapi.json
```

Raw OpenAPI specification in JSON format. Useful for:

-   Generating client SDKs
-   Importing into Postman
-   CI/CD validation

---

## ğŸ“Š How It Works

### 1. Define Schemas

```python
# Pydantic model defines the shape of data
from pydantic import BaseModel, Field

class UserCreateSchema(BaseModel):
    username: str = Field(..., min_length=3, max_length=80)
    email: str = Field(..., pattern=r'^[\w\.-]+@[\w\.-]+\.\w+$')
    password: str = Field(..., min_length=8)
```

### 2. Use in Routes

```python
from flask_openapi3 import APIBlueprint

bp = APIBlueprint("users", __name__)

@bp.post(
    "/register",
    summary="Register User",
    description="Create a new user account",
    responses={
        201: UserDataResponse,
        422: StandardErrorResponse,
    }
)
def register(body: UserCreateSchema):
    # body is already validated!
    user = UserService.create(body)
    return success_response(data=user, status_code=201)
```

### 3. Auto-Generated Documentation

The schema becomes documentation:

```yaml
# Generated OpenAPI spec
paths:
    /api/v1/auth/register:
        post:
            summary: Register User
            description: Create a new user account
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserCreateSchema"
            responses:
                "201":
                    description: Success
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/UserDataResponse"
                "422":
                    description: Validation Error
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/StandardErrorResponse"
```

---

## ğŸ“Š Request Types

### Path Parameters

```python
from pydantic import BaseModel, Field

class UserPath(BaseModel):
    user_id: int = Field(..., description="User ID", ge=1)

@bp.get("/<int:user_id>")
def get_user(path: UserPath):
    user = UserService.get_by_id(path.user_id)
    return success_response(data=user)
```

### Query Parameters

```python
class UserListQuery(BaseModel):
    page: int = Field(default=1, ge=1)
    per_page: int = Field(default=20, ge=1, le=100)
    include_deleted: bool = Field(default=False)

@bp.get("/")
def get_users(query: UserListQuery):
    users = UserService.get_all(page=query.page, per_page=query.per_page)
    return success_response(data=users)
```

### Request Body

```python
class UserCreateSchema(BaseModel):
    username: str
    email: str
    password: str

@bp.post("/")
def create_user(body: UserCreateSchema):
    user = UserService.create(body)
    return success_response(data=user, status_code=201)
```

### Headers

```python
class AuthHeader(BaseModel):
    authorization: str = Field(..., alias="Authorization")

@bp.get("/protected")
def protected_route(header: AuthHeader):
    token = header.authorization.replace("Bearer ", "")
    # ...
```

---

## ğŸ“Š Tags for Organization

Tags group related endpoints in documentation:

```python
from flask_openapi3 import APIBlueprint, Tag

# Define tag
tag = Tag(
    name="Users (v1)",
    description="User management - CRUD operations"
)

# Use in blueprint
users_bp = APIBlueprint(
    "users_v1",
    __name__,
    url_prefix="/users",
    abp_tags=[tag],  # All routes in this blueprint get this tag
)
```

---

## ğŸ”’ Security Definitions

For JWT authentication:

```python
# In route decorator
@bp.put(
    "/<int:user_id>",
    security=[{"jwt": []}],  # Requires JWT
)
@jwt_required()
def update_user(path: UserPath, body: UserUpdateSchema):
    # ...
```

In Swagger UI, this adds a lock icon and requires authentication.

---

## ğŸ“Š Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLASK-OPENAPI3 FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   1. DEFINE SCHEMA                                               â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚      class UserCreate(BaseModel):                                â”‚
â”‚          username: str                                           â”‚
â”‚          email: str                                              â”‚
â”‚                                                                  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚                                                                  â”‚
â”‚   2. USE IN ROUTE                                                â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚      @bp.post("/users")                                          â”‚
â”‚      def create(body: UserCreate):                               â”‚
â”‚                                                                  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚                                                                  â”‚
â”‚   3. AUTO-GENERATED                                              â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚      â”‚   Swagger UI       â”‚  â”‚   OpenAPI JSON     â”‚              â”‚
â”‚      â”‚   Interactive      â”‚  â”‚   Machine-readable â”‚              â”‚
â”‚      â”‚   Documentation    â”‚  â”‚   Specification    â”‚              â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚                                                                  â”‚
â”‚   4. REQUEST VALIDATION                                          â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚      Invalid data â†’ 422 error (automatic)                        â”‚
â”‚      Valid data â†’ Route handler receives validated object        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”œ Next Steps

Now let's see how our routes are organized.

**Next: [4.3_routes_structure.md](./4.3_routes_structure.md)** - How routes are organized.
